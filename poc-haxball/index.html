<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 1</title>
    
    <script src="//cdn.jsdelivr.net/npm/phaser@3.19.0/dist/phaser.js"></script>

    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    class gamescene extends Phaser.Scene {

        constructor()
        { super('gamescene') }

        check_mov_player_one(){
            
            if (this.cursor_one.left.isDown){
                this.player_one.setVelocityX(-250);       
            }      

            else if (this.cursor_one.right.isDown){
                this.player_one.setVelocityX(250);      
            }      

            else if (this.cursor_one.up.isDown){
                this.player_one.setVelocityY(-250);      
            }      

            else if (this.cursor_one.down.isDown){
                this.player_one.setVelocityY(250);   
            }  

            else if (this.cursor_one.left.isUp && this.cursor_one.right.isUp && this.cursor_one.up.isUp && this.cursor_one.down.isUp){
                this.player_one.setVelocity(0)
            }

        }

        check_mov_player_two(){
            if (this.cursor_two.left.isDown){
                this.player_two.setVelocityX(-250);       
            }      

            else if (this.cursor_two.right.isDown){
                this.player_two.setVelocityX(250);      
            }      

            else if (this.cursor_two.up.isDown){
                this.player_two.setVelocityY(-250);      
            }      

            else if (this.cursor_two.down.isDown){
                this.player_two.setVelocityY(250);   
            }  

            else if (this.cursor_two.left.isUp && this.cursor_two.right.isUp && this.cursor_two.up.isUp && this.cursor_two.down.isUp){
                this.player_two.setVelocity(0)
            }

        }

        check_touching_ball(){
            this.timedEvent.paused = false    
        }
                
        stop_ball(){
            for (var speed = 100; speed >= 0; speed--){
                this.ball.setVelocity(speed)
            }
            this.timedEvent=this.time.delayedCall(500, this.stop_ball, [], this);
            this.timedEvent.paused = true
        }

        preload()
        {
            this.load.image('field-1', 'assets/field-1.png');
            this.load.image('ball', 'assets/ball.png')
            this.load.spritesheet('dude', 
            'assets/dude.png',
            { frameWidth: 32, frameHeight: 48 }
        ); 
        }

        create()
        {
            this.timedEvent = this.time.delayedCall(500, this.stop_ball, [], this);
            this.timedEvent.paused = true
            
            this.add.image(600,200,'field-1')
            this.ball = this.physics.add.image(600,200, 'ball')
            this.ball.setCollideWorldBounds(true)

            this.player_one = this.physics.add.sprite(250, 250, 'dude');
            this.player_one.setCollideWorldBounds(true);

            this.player_two = this.physics.add.sprite(850, 250, 'dude');
            this.player_two.setCollideWorldBounds(true);

            this.cursor_one = this.input.keyboard.createCursorKeys();
            this.cursor_two = this.input.keyboard.addKeys(
                {             
                    'left' : Phaser.Input.Keyboard.KeyCodes.A,
                    'right': Phaser.Input.Keyboard.KeyCodes.D, 
                    'up'   : Phaser.Input.Keyboard.KeyCodes.W, 
                    'down' : Phaser.Input.Keyboard.KeyCodes.S 
                }
                )
       

            this.c_player = this.physics.add.collider(this.player_one, this.player_two);
            this.c_one_ball = this.physics.add.collider(this.player_one, this.ball, this.check_touching_ball, null, this);
            this.c_two_ball = this.physics.add.collider(this.player_two, this.ball, this.check_touching_ball,  null,this);
            }

        update()
        {         
            this.check_mov_player_one()
            this.check_mov_player_two()             
        }

    }


var config = {
        type: Phaser.AUTO,
        width: 1200,
        height: 400,
        physics: {
        default: 'arcade',
        arcade: {
            gravity: { y:0, x:0 },
            debug: false
        }
    },
        scene: [gamescene]
    };

    var game = new Phaser.Game(config);
</script>

</body>
</html>